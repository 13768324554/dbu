#!/bin/bash
#Description: gtk/zenity wrapper for torrent creation using transmission-create
#License: MIT

infile="$1"

if [[ ! -e "$infile" ]]; then
    echo "ERROR: no input file"; exit 1
fi

_savetorrent() {
    zenity \
    --title "Save torrent file..." \
    --window-icon="info" \
    --file-selection --confirm-overwrite --save \
    --filename="$1.torrent" \
    --file-filter="*.torrent"
}

outfile=$(_savetorrent "$infile") 

transmission-create \
	--tracker udp://tracker.openbittorrent.com:80 \
	--tracker udp://tracker.ccc.de:80 \
	--tracker udp://tracker.publicbt.com:80 \
	--tracker udp://tracker.istole.it:80 \
	--outfile="$outfile" \
    "$infile" | \
zenity --auto-close --auto-kill --progress --pulsate --title="Creating torrent..." \
    --text="Please wait while creating torrent..." 


_addtorrent() {
    transmission-gtk "$outfile"
}

zenity --question --title "Torrent created" --text "<b>Done!</b>\nWould you like to start seeding\n this torrent now?"

if [[ $? == 0 ]] ; then
    _addtorrent & sleep 5
fi

